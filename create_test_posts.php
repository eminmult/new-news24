<?php

require __DIR__.'/vendor/autoload.php';

$app = require_once __DIR__.'/bootstrap/app.php';
$app->make('Illuminate\Contracts\Console\Kernel')->bootstrap();

use App\Models\Post;
use App\Models\Category;
use App\Models\Author;
use App\Models\PostType;
use App\Models\Tag;
use Carbon\Carbon;
use Illuminate\Support\Str;

// Получаем категории, авторов и типы
$categories = Category::all();
$authors = Author::all();
$postTypes = PostType::all();

if ($categories->isEmpty() || $authors->isEmpty() || $postTypes->isEmpty()) {
    echo "Ошибка: нет категорий, авторов или типов постов\n";
    exit(1);
}

// Создаем или получаем теги
$tags = [];
$tagNames = ['политика', 'экономика', 'спорт', 'культура', 'технологии', 'наука', 'общество', 'мир'];
foreach ($tagNames as $tagName) {
    $tag = Tag::firstOrCreate(
        ['slug' => Str::slug($tagName)],
        ['name' => $tagName]
    );
    $tags[] = $tag;
}

// Тестовые новости
$testPosts = [
    [
        'title' => 'Президент провел встречу с министром экономики',
        'content' => '<p>Сегодня состоялась важная встреча между президентом и министром экономики. На встрече обсуждались вопросы развития национальной экономики и поддержки малого и среднего бизнеса.</p><p>Президент отметил важность создания благоприятных условий для предпринимателей и подчеркнул необходимость дальнейшего развития инфраструктуры.</p><p>Министр представил план мероприятий на ближайший квартал, который включает в себя ряд инициатив по поддержке экспорта и привлечению иностранных инвестиций.</p>',
        'types' => ['Новость'],
        'tags' => ['политика', 'экономика'],
        'is_featured' => true,
        'show_in_slider' => true,
    ],
    [
        'title' => 'Открытие нового культурного центра в Баку',
        'content' => '<p>Вчера в столице состоялось торжественное открытие нового культурного центра. Современное здание площадью более 5000 квадратных метров станет домом для выставок, концертов и театральных постановок.</p><p>На церемонии открытия присутствовали известные деятели культуры и искусства. Центр оснащен самым современным оборудованием и предлагает посетителям широкий спектр культурных мероприятий.</p><p>Первая выставка, посвященная современному азербайджанскому искусству, откроется уже на следующей неделе.</p>',
        'types' => ['Новость', 'Фото'],
        'tags' => ['культура', 'общество'],
        'is_featured' => false,
        'show_in_slider' => true,
    ],
    [
        'title' => 'Сборная Азербайджана готовится к важному матчу',
        'content' => '<p>Национальная футбольная команда проводит интенсивные тренировки перед предстоящим матчем квалификации. Главный тренер провел открытую пресс-конференцию, на которой рассказал о тактике команды.</p><p>"Мы готовы показать лучшую игру и порадовать наших болельщиков", - заявил наставник команды.</p><p>Матч состоится в эту субботу на Национальном стадионе. Ожидается аншлаг - все билеты уже проданы.</p>',
        'types' => ['Новость', 'Видео'],
        'tags' => ['спорт'],
        'is_featured' => true,
        'show_in_slider' => true,
    ],
    [
        'title' => 'Эксклюзивное интервью с известным режиссером',
        'content' => '<p>В эксклюзивном интервью нашему изданию известный режиссер рассказал о своем новом проекте. Съемки фильма уже начались, и премьера запланирована на конец года.</p><p>"Это будет совершенно новый взгляд на исторические события. Мы работаем с лучшими актерами и используем самые современные технологии", - поделился режиссер.</p><p>Фильм снимается сразу на трех языках и будет представлен на международных кинофестивалях.</p><p><strong>Вопрос:</strong> Что вдохновило вас на создание этого фильма?</p><p><strong>Ответ:</strong> История нашего народа полна драматических и вдохновляющих моментов. Я хотел показать их через призму современного кинематографа.</p>',
        'types' => ['Спецрепортаж'],
        'tags' => ['культура'],
        'is_featured' => false,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Новые технологии в азербайджанском образовании',
        'content' => '<p>Министерство образования объявило о внедрении цифровых технологий во все школы страны. Программа рассчитана на три года и включает оснащение классов современным оборудованием.</p><p>Каждая школа получит интерактивные доски, планшеты для учеников и доступ к образовательным онлайн-платформам. Учителя пройдут специальное обучение по работе с новыми технологиями.</p><p>Пилотный проект уже запущен в 50 школах и показывает отличные результаты. Успеваемость учеников выросла на 15%, а вовлеченность в учебный процесс значительно повысилась.</p>',
        'types' => ['Статья'],
        'tags' => ['технологии', 'общество'],
        'is_featured' => true,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Фоторепортаж: Весна в Азербайджане',
        'content' => '<p>Наш фотокорреспондент запечатлел самые красивые моменты весны в разных регионах Азербайджана. От цветущих садов Гянджи до горных пейзажей Габалы - природа нашей страны удивляет своим разнообразием.</p><p>Особенно впечатляют фотографии из Губы, где расцвели тысячи яблоневых деревьев, создавая невероятное зрелище.</p><p>Смотрите нашу полную галерею из 50 фотографий, которые покажут вам всю красоту азербайджанской весны.</p>',
        'types' => ['Фото'],
        'tags' => ['культура'],
        'is_featured' => false,
        'show_in_slider' => true,
    ],
    [
        'title' => 'Видеорепортаж: День в жизни бакинского таксиста',
        'content' => '<p>Мы провели целый день с одним из бакинских таксистов, чтобы показать вам, как выглядит его работа изнутри. От раннего утра до поздней ночи - в нашем видеорепортаже.</p><p>Рашид работает таксистом уже 10 лет и знает столицу как свои пять пальцев. Он поделился с нами интересными историями о пассажирах и рассказал о том, как изменился город за эти годы.</p><p>"Каждый день я встречаю новых людей, каждый со своей историей. Это делает мою работу интересной", - говорит Рашид.</p>',
        'types' => ['Видео'],
        'tags' => ['общество'],
        'is_featured' => false,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Подкаст: Разговор о современной музыке',
        'content' => '<p>В новом выпуске нашего подкаста мы беседуем с музыкальным продюсером о современных трендах в азербайджанской музыке. Как меняется индустрия? Какие жанры популярны среди молодежи?</p><p>Наш гость рассказывает о работе с молодыми исполнителями и о том, как социальные сети изменили музыкальную индустрию.</p><p>Также обсуждаем влияние мировых трендов на местную сцену и перспективы азербайджанских артистов на международном уровне.</p>',
        'types' => ['Аудио'],
        'tags' => ['культура'],
        'is_featured' => false,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Мнение: Будущее общественного транспорта в Баку',
        'content' => '<p>Развитие общественного транспорта - одна из ключевых задач для современного Баку. Город растет, население увеличивается, и транспортная система должна соответствовать новым требованиям.</p><p>На мой взгляд, необходимо расширить сеть метро, особенно в новых районах города. Также важно развивать автобусное сообщение и создавать выделенные полосы для общественного транспорта.</p><p>Электрификация транспорта - еще одно важное направление. Электробусы уже показали свою эффективность во многих городах мира, и Баку не должен отставать.</p><p>Важно также развивать инфраструктуру для велосипедистов. Велодорожки и станции проката велосипедов могут стать отличным дополнением к общественному транспорту.</p>',
        'types' => ['Комментарий'],
        'tags' => ['общество'],
        'is_featured' => false,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Экономический прорыв: рост ВВП превысил прогнозы',
        'content' => '<p>По данным Государственного комитета по статистике, рост ВВП в первом квартале превысил все прогнозы, составив 7,2%. Это лучший показатель за последние пять лет.</p><p>Основной вклад в рост внесли нефтегазовый сектор, строительство и сфера услуг. Эксперты отмечают стабильное развитие экономики и положительные тенденции во всех отраслях.</p><p>Министр экономики прокомментировал эти данные: "Мы видим результаты проведенных реформ. Экономика демонстрирует устойчивый рост, и мы продолжим работу по созданию благоприятного инвестиционного климата."</p>',
        'types' => ['Новость', 'Статья'],
        'tags' => ['экономика'],
        'is_featured' => true,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Научный прорыв: азербайджанские ученые создали новый материал',
        'content' => '<p>Группа ученых из Бакинского государственного университета разработала инновационный материал, который может революционизировать строительную индустрию. Новый композит обладает высокой прочностью и при этом в два раза легче традиционных материалов.</p><p>Исследования проводились в течение трех лет при поддержке государственного гранта. Ученые уже подали заявку на международный патент.</p><p>"Наш материал может использоваться в сейсмоустойчивом строительстве, что особенно актуально для нашего региона", - отметил руководитель проекта, профессор Алиев.</p><p>Первые образцы уже прошли лабораторные испытания, и результаты превзошли ожидания. Планируется начать промышленное производство в следующем году.</p>',
        'types' => ['Новость', 'Спецрепортаж'],
        'tags' => ['наука', 'технологии'],
        'is_featured' => true,
        'show_in_slider' => true,
    ],
    [
        'title' => 'Фестиваль мугама собрал тысячи зрителей',
        'content' => '<p>Международный фестиваль мугама завершился грандиозным концертом в Филармонии. За три дня фестиваля состоялось более 20 концертов и мастер-классов.</p><p>В фестивале приняли участие музыканты из 15 стран. Зрители смогли насладиться как традиционным мугамом, так и современными интерпретациями этого древнего искусства.</p><p>Особенно запомнился совместный концерт азербайджанских и иранских музыкантов, который показал глубокую связь между культурами наших народов.</p><p>Организаторы уже анонсировали, что следующий фестиваль состоится через год и будет еще масштабнее.</p>',
        'types' => ['Новость', 'Фото', 'Видео'],
        'tags' => ['культура'],
        'is_featured' => false,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Аналитика: Перспективы развития IT-сектора в Азербайджане',
        'content' => '<p>IT-сектор Азербайджана демонстрирует впечатляющий рост в последние годы. Количество IT-компаний увеличилось на 40%, а экспорт IT-услуг вырос вдвое.</p><p>Государство активно поддерживает развитие этой отрасли: созданы технопарки, предоставляются налоговые льготы, развивается IT-образование.</p><p>Особенно быстро растет сектор разработки мобильных приложений и веб-сервисов. Несколько азербайджанских стартапов уже получили международное признание.</p><p>Эксперты прогнозируют, что к 2030 году IT-сектор может стать одной из ключевых отраслей экономики страны. Для этого необходимо продолжить работу по подготовке квалифицированных кадров и улучшению инфраструктуры.</p><p>Важную роль играет также развитие экосистемы стартапов. Венчурные фонды, акселераторы и коворкинги - все это создает благоприятную среду для инноваций.</p>',
        'types' => ['Статья', 'Комментарий'],
        'tags' => ['технологии', 'экономика'],
        'is_featured' => true,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Спецрепортаж: Возрождение традиционных ремесел',
        'content' => '<p>Мы посетили несколько мастерских в старой части Баку, где мастера сохраняют древние традиции азербайджанских ремесел. Ковроткачество, керамика, чеканка - эти искусства передаются из поколения в поколение.</p><p>Мастер Гасым уже 40 лет занимается чеканкой. Его работы известны далеко за пределами Азербайджана. "Важно не просто сохранить традицию, но и развивать ее, находить современное применение древним техникам", - говорит он.</p><p>Государство поддерживает мастеров: организуются выставки, создаются ремесленные центры, где молодежь может обучиться традиционным ремеслам.</p><p>Особенно радует, что среди учеников много молодых людей. Они понимают ценность традиций и хотят их сохранить для будущих поколений.</p><p>В репортаже мы покажем весь процесс создания традиционного азербайджанского ковра - от подготовки пряжи до финального узора.</p>',
        'types' => ['Спецрепортаж', 'Фото'],
        'tags' => ['культура', 'общество'],
        'is_featured' => false,
        'show_in_slider' => false,
    ],
    [
        'title' => 'Экологическая инициатива: Баку станет зеленее',
        'content' => '<p>Мэрия Баку запустила масштабную программу озеленения города. В течение года планируется высадить 100 тысяч деревьев и создать 20 новых парков.</p><p>Программа включает не только посадку деревьев, но и создание системы ухода за зелеными насаждениями, установку систем автоматического полива и обучение специалистов.</p><p>К участию в программе приглашаются все желающие. Жители города могут принять участие в субботниках по посадке деревьев в своих районах.</p><p>"Зеленый город - здоровый город. Мы хотим, чтобы Баку стал одним из самых зеленых городов региона", - заявил представитель мэрии.</p><p>Первые деревья будут высажены уже в следующем месяце в новом парке на берегу Каспия.</p>',
        'types' => ['Новость', 'Видео'],
        'tags' => ['общество'],
        'is_featured' => false,
        'show_in_slider' => false,
    ],
];

echo "Начинаем создание тестовых постов...\n\n";

foreach ($testPosts as $index => $postData) {
    $num = $index + 1;
    echo "[$num/" . count($testPosts) . "] Создаем: {$postData['title']}\n";

    // Создаем пост
    $post = new Post();
    $post->title = $postData['title'];
    $post->slug = Str::slug($postData['title']) . '-' . time() . '-' . rand(100, 999);
    $post->content = $postData['content'];
    $post->meta_title = $postData['title'];
    $post->meta_description = mb_substr(strip_tags($postData['content']), 0, 155);

    // Случайная категория
    $post->category_id = $categories->random()->id;

    // Случайный автор
    $post->author_id = $authors->random()->id;

    // Статистика
    $post->views = rand(100, 5000);
    $post->read_time = rand(3, 15);

    // Статусы
    $post->is_featured = $postData['is_featured'];
    $post->is_published = true;
    $post->published_at = Carbon::now()->subDays(rand(0, 30));
    $post->show_on_homepage = true;
    $post->show_in_slider = $postData['show_in_slider'];

    $post->save();

    // Привязываем типы
    $typeIds = [];
    foreach ($postData['types'] as $typeName) {
        $type = $postTypes->firstWhere('name', $typeName);
        if ($type) {
            $typeIds[] = $type->id;
        }
    }
    if (!empty($typeIds)) {
        $post->types()->attach($typeIds);
    }

    // Привязываем теги
    $postTags = [];
    foreach ($postData['tags'] as $tagName) {
        $tag = collect($tags)->firstWhere('name', $tagName);
        if ($tag) {
            $postTags[] = $tag->id;
        }
    }
    if (!empty($postTags)) {
        $post->tags()->attach($postTags);
    }

    // Привязываем к категории (many-to-many)
    $randomCategories = $categories->random(rand(1, 3))->pluck('id')->toArray();
    $post->categories()->attach($randomCategories);

    echo "  ✓ Создан пост ID: {$post->id}\n";
    echo "  ✓ Типы: " . implode(', ', $postData['types']) . "\n";
    echo "  ✓ Теги: " . implode(', ', $postData['tags']) . "\n\n";
}

echo "✓ Создано " . count($testPosts) . " тестовых постов!\n";
